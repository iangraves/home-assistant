set_all_ac_mode:
  alias: Set All ACs Mode (Selective)
  fields:
    mode:
      description: "HVAC mode: cool, heat, off"
      example: "cool"
    fan:
      description: "Fan speed: low, medium, high"
      example: "medium"
    temperature:
      description: "Target temperature"
      example: 70
    entities:
      description: "List of climate entities to control"
      example: "climate.living_room_ac"
  sequence:
    - choose:
        - conditions: "{{ entities | length > 0 }}"
          sequence:
            - service: climate.set_hvac_mode
              data:
                entity_id: "{{ entities }}"
                hvac_mode: "{{ mode | string | lower }}"

            - delay: "00:00:01"

            - service: climate.set_temperature
              data:
                entity_id: "{{ entities }}"
                temperature: "{{ temperature | float(70) }}"
                fan_mode: "{{ fan }}"

    - service: input_select.select_option
      data:
        entity_id: input_select.hvac_mode_state
        option: >-
          {% if mode == 'off' %}False{% else %}{{ mode }}{% endif %}

    - service: input_datetime.set_datetime
      data:
        entity_id: input_datetime.hvac_last_mode_change
        datetime: "{{ now().strftime('%Y-%m-%d %H:%M:%S') }}"

    - service: notify.persistent_notification
      data:
        title: "HVAC Mode Changed"
        message: "Mode set to '{{ mode }}' at {{ temperature | float(70) }}Â°F with fan '{{ fan }}' for {{ entities | join(', ') }}"
